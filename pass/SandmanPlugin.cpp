#include "CfgPass.h"
#include "DummyPass.h"

#include "llvm/Passes/PassBuilder.h"
#include "llvm/Passes/PassPlugin.h"

using namespace llvm;

extern "C" LLVM_ATTRIBUTE_WEAK ::PassPluginLibraryInfo
llvmGetPassPluginInfo() {
    return {.APIVersion = LLVM_PLUGIN_API_VERSION,
            .PluginName = "MyPlugin",
            .PluginVersion = "v0.1",
            .RegisterPassBuilderCallbacks = [](PassBuilder &PB) {
                PB.registerAnalysisRegistrationCallback(
                    [](ModuleAnalysisManager &MAM) { MAM.registerPass([&] { return CfgPass(); }); });

                PB.registerPipelineStartEPCallback(
                    [](ModulePassManager &MPM, OptimizationLevel Level) { MPM.addPass(DummyPass()); });
            }};
}
